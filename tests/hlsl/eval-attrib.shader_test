[require]
shader model >= 5.0

[rtv 0]
format r32g32b32a32 float
size (2dms, 4, 640, 480)

[uav 1]
format r32 sint
size (buffer, 16)
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648

[vertex shader]
void main(uint id : SV_VertexID, out float4 position : SV_Position, out float2 attr : ATTR)
{
    float2 coords = float2((id << 1) & 2, id & 2);
    position = float4(coords * float2(2, -2) + float2(-1, 1), 0, 1);
    attr = position.xy;
}

[pixel shader todo]
RWBuffer<int> u1 : register(u1);

float4 main(float4 pos : SV_Position, float2 attr : ATTR, uint sample_idx : SV_SampleIndex) : SV_Target
{
    float2 eval = EvaluateAttributeCentroid(attr);
    eval = float2(eval.x * 320.0 + 320.0, -eval.y * 240.0 + 240.0);
    eval = round((eval - pos.xy) * 1000.0);
    int2 delta = eval;
    uint offset = sample_idx * 4;
    InterlockedMin(u1[offset + 0], delta.x);
    InterlockedMax(u1[offset + 1], delta.x);
    InterlockedMin(u1[offset + 2], delta.y);
    InterlockedMax(u1[offset + 3], delta.y);
    return float4(0.0, 1.0, 0.0, 1.0);
}

[test]
todo draw triangle list 3
probe all rgba (0.0, 1.0, 0.0, 1.0)
bug(radv) broken(warp) probe uav 1 (0) rgbai (0, 0, 0, 0)
bug(radv) broken(warp) probe uav 1 (1) rgbai (0, 0, 0, 0)
bug(radv) broken(warp) probe uav 1 (2) rgbai (0, 0, 0, 0)
bug(radv) broken(warp) probe uav 1 (3) rgbai (0, 0, 0, 0)


[require]
shader model >= 5.0
non-warp

[uav 1]
format r32 sint
size (buffer, 16)
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648
2147483647 -2147483648 2147483647 -2147483648

[vertex shader]
void main(uint id : SV_VertexID, out float4 position : SV_Position, out float2 attr : ATTR)
{
    float2 coords = float2((id << 1) & 2, id & 2);
    position = float4(coords * float2(2, -2) + float2(-1, 1), 0, 1);
    attr = position.xy;
}

[pixel shader todo]
RWBuffer<int> u1 : register(u1);

float4 main(float4 pos : SV_Position, float2 attr : ATTR, uint sample_idx : SV_SampleIndex) : SV_Target
{
    float2 eval = EvaluateAttributeAtSample(attr, sample_idx);
    eval = float2(eval.x * 320.0 + 320.0, -eval.y * 240.0 + 240.0);
    eval = round((eval - pos.xy) * 1000.0);
    int2 delta = eval;
    uint offset = sample_idx * 4;
    InterlockedMin(u1[offset + 0], delta.x);
    InterlockedMax(u1[offset + 1], delta.x);
    InterlockedMin(u1[offset + 2], delta.y);
    InterlockedMax(u1[offset + 3], delta.y);
    return float4(0.0, 1.0, 0.0, 1.0);
}

[test]
clear rtv 0 0.0 0.0 0.0 0.0
todo draw triangle list 3
probe all rgba (0.0, 1.0, 0.0, 1.0)
bug(radv) probe uav 1 (0) rgbai (-125, -125, -375, -375)
bug(radv) probe uav 1 (1) rgbai (375, 375, -125, -125)
bug(radv) probe uav 1 (2) rgbai (-375, -375, 125, 125)
bug(radv) probe uav 1 (3) rgbai (125, 125, 375, 375)
